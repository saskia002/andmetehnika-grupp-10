x-superset-image: &superset-image apachesuperset.docker.scarf.sh/apache/superset:${TAG:-latest-dev}
x-superset-volumes: &superset-volumes # /app/pythonpath_docker will be appended to the PYTHONPATH in the final container
    - ./docker:/app/docker # optionally comment me out if having bash/r error - will need to manually install clickhouse_connect on Superset container
    - ./superset-core:/app/superset-core # optionally comment me out if having bash/r error - will need to manually install clickhouse_connect on Superset container
    - superset_home:/app/superset_home

services:
    redis:
        image: redis:7
        container_name: superset_cache
        volumes:
            - redis:/data

    db:
        env_file:
            - path: docker/.env # default
              required: true
            - path: docker/.env-local # optional override
              required: false
        image: postgres:16
        container_name: superset_db
        volumes:
            - db_home:/var/lib/postgresql/data
            - ./docker/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d

    superset:
        env_file:
            - path: docker/.env # default
              required: true
            - path: docker/.env-local # optional override
              required: false
        image: *superset-image
        container_name: superset_app
        command: ["/app/docker/docker-bootstrap.sh", "app-gunicorn"]
        user: "root"
        ports:
            - 8088:8088
        depends_on:
            superset-init:
                condition: service_completed_successfully
        volumes: *superset-volumes

    superset-init:
        image: *superset-image
        container_name: superset_init
        command: ["/app/docker/docker-init.sh"]
        env_file:
            - path: docker/.env # default
              required: true
            - path: docker/.env-local # optional override
              required: false
        depends_on:
            db:
                condition: service_started
            redis:
                condition: service_started
        user: "root"
        volumes: *superset-volumes
        healthcheck:
            disable: true

    superset-worker:
        image: *superset-image
        container_name: superset_worker
        command: ["/app/docker/docker-bootstrap.sh", "worker"]
        env_file:
            - path: docker/.env # default
              required: true
            - path: docker/.env-local # optional override
              required: false
        depends_on:
            superset-init:
                condition: service_completed_successfully
        user: "root"
        volumes: *superset-volumes
        healthcheck:
            test: ["CMD-SHELL", "celery -A superset.tasks.celery_app:app inspect ping -d celery@$$HOSTNAME"]

    superset-worker-beat:
        image: *superset-image
        container_name: superset_worker_beat
        command: ["/app/docker/docker-bootstrap.sh", "beat"]
        env_file:
            - path: docker/.env # default
              required: true
            - path: docker/.env-local # optional override
              required: false
        depends_on:
            superset-init:
                condition: service_completed_successfully
        user: "root"
        volumes: *superset-volumes
        healthcheck:
            disable: true

    minio:
        image: minio/minio:RELEASE.2024-10-13T13-34-11Z
        container_name: minio
        ports:
            - "9000:9000" # MinIO API
            - "9901:9001" # MinIO Console
        environment:
            MINIO_ROOT_USER: minioadmin
            MINIO_ROOT_PASSWORD: minioadmin
        command: server /data --console-address ":9001"
        volumes:
            - ./.minio_data:/data
        #networks:
        #    iceberg_network:
        #        aliases:
        #            - minio

    iceberg_rest:
        image: tabulario/iceberg-rest:1.6.0
        container_name: iceberg_rest
        ports:
            - "8181:8181"
        environment:
            AWS_ACCESS_KEY_ID: minioadmin
            AWS_SECRET_ACCESS_KEY: minioadmin
            AWS_REGION: us-east-1
            AWS_ENDPOINT: http://minio:9000
            CATALOG__REST__URI: http://iceberg_rest:8181/
            CATALOG__REST__WAREHOUSE: s3://bucket/
            CATALOG__REST__IO__IMPL: org.apache.iceberg.aws.s3.S3FileIO
            CATALOG__REST__S3__ENDPOINT: http://minio:9000
            CATALOG__REST__S3__ACCESS-KEY-ID: minioadmin
            CATALOG__REST__S3__SECRET-ACCESS-KEY: minioadmin
        depends_on:
            - minio
        #volumes:
        #    - tmp_shared:/tmp
        #networks:
        #    iceberg_network:

    iceberg-init:
        user: root
        image: python:3.12
        container_name: iceberg-init
        depends_on:
            - minio
            - iceberg_rest
        #networks:
        #    - iceberg_network
        volumes:
            - ./iceberg:/iceberg # contains init files
            - ./requirements.txt:/requirements.txt:ro
        environment:
            PYICEBERG_HOME: /iceberg
            PYICEBERG_CATALOG__REST__URI: http://iceberg_rest:8181/
            PYICEBERG_CATALOG__REST__WAREHOUSE: s3://bucket/
            PYICEBERG_CATALOG__REST__IO__IMPL: org.apache.iceberg.aws.s3.S3FileIO
            PYICEBERG_CATALOG__REST__S3__ENDPOINT: http://minio:9000
            PYICEBERG_CATALOG__REST__S3__ACCESS-KEY-ID: minioadmin
            PYICEBERG_CATALOG__REST__S3__SECRET-ACCESS-KEY: minioadmin
        working_dir: /iceberg
        command: >
            bash -c "
              echo 'Installing dependencies...' &&
              pip install -r /requirements.txt &&
              echo 'Waiting for iceberg...' &&
              sleep 10 &&
              python init_s3_bucket.py &&
              python init_duck_db.py &&
              python init_iceberg.py &&
              chmod -R 777 /tmp
            "

    airflow-db:
        container_name: airflow-db
        image: postgres:16.4
        #depends_on:
        #    - iceberg-init
        environment:
            POSTGRES_USER: airflow
            POSTGRES_PASSWORD: airflow
            POSTGRES_DB: airflow
            PGUSER: airflow
            PGPASSWORD: airflow
            PGDATABASE: airflow
        ports:
            - "5432:5432"
        volumes:
            - ./pgdata_airflow:/var/lib/postgresql/data
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U airflow"]
            interval: 10s
            retries: 5
        restart: always

    airflow-webserver:
        #image: apache/airflow:2.8.1
        build:
            context: ./dags # Build context is the current directory
            dockerfile: Dockerfile # Use the Dockerfile in this directory to build the image
        container_name: airflow-webserver
        command: webserver
        user: root
        environment:
            AIRFLOW__CORE__EXECUTOR: LocalExecutor
            AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@airflow-db:5432/airflow
            AIRFLOW__CORE__LOAD_EXAMPLES: "false"
            AIRFLOW__API__AUTH_BACKENDS: "airflow.api.auth.backend.basic_auth"
            AIRFLOW_CONN_OPENMETADATA_API: http://openmetadata-server:8585
            #_PIP_ADDITIONAL_REQUIREMENTS: "apache-airflow-providers-mongo pymongo yfinance==0.2.66 multitasking==0.0.11"

            PYICEBERG_HOME: /iceberg
            PYICEBERG_CATALOG__REST__URI: http://iceberg_rest:8181/
            PYICEBERG_CATALOG__REST__WAREHOUSE: s3://bucket/
            PYICEBERG_CATALOG__REST__IO__IMPL: org.apache.iceberg.aws.s3.S3FileIO
            PYICEBERG_CATALOG__REST__S3__ENDPOINT: http://minio:9000
            PYICEBERG_CATALOG__REST__S3__ACCESS-KEY-ID: minioadmin
            PYICEBERG_CATALOG__REST__S3__SECRET-ACCESS-KEY: minioadmin
        ports:
            - "8080:8080"
        volumes:
            - ./iceberg:/iceberg # contains init files
            - ./dags:/opt/airflow/dags
            - ./logs:/opt/airflow/logs
            - ./plugins:/opt/airflow/plugins
            - /var/run/docker.sock:/var/run/docker.sock
            - ./clickhouse:/opt/airflow/clickhouse
        depends_on:
            - airflow-init
            - airflow-db
            - iceberg-init
        restart: always

    airflow-scheduler:
        build:
            context: ./dags # Build context is the current directory
            dockerfile: Dockerfile # Use the Dockerfile in this directory to build the image
        container_name: airflow-scheduler
        command: scheduler
        user: root

        environment:
            AIRFLOW__CORE__EXECUTOR: LocalExecutor
            AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@airflow-db:5432/airflow
            AIRFLOW__CORE__LOAD_EXAMPLES: "false"
            AIRFLOW_CONN_OPENMETADATA_API: http://openmetadata-server:8585
            #_PIP_ADDITIONAL_REQUIREMENTS: "apache-airflow-providers-mongo pymongo yfinance==0.2.66 multitasking==0.0.11 requests"
            CLICKHOUSE_USER: etl
            CLICKHOUSE_PASSWORD: pass

            PYICEBERG_HOME: /iceberg
            PYICEBERG_CATALOG__REST__URI: http://iceberg_rest:8181/
            PYICEBERG_CATALOG__REST__WAREHOUSE: s3://bucket/
            PYICEBERG_CATALOG__REST__IO__IMPL: org.apache.iceberg.aws.s3.S3FileIO
            PYICEBERG_CATALOG__REST__S3__ENDPOINT: http://minio:9000
            PYICEBERG_CATALOG__REST__S3__ACCESS-KEY-ID: minioadmin
            PYICEBERG_CATALOG__REST__S3__SECRET-ACCESS-KEY: minioadmin

        volumes:
            - ./dags:/opt/airflow/dags
            - ./logs:/opt/airflow/logs
            - ./plugins:/opt/airflow/plugins
            - /var/run/docker.sock:/var/run/docker.sock
            - ./clickhouse:/opt/airflow/clickhouse
        depends_on:
            - airflow-init
            - airflow-db
            - iceberg-init
        restart: always

    airflow-init:
        build:
            context: ./dags # Build context is the current directory
            dockerfile: Dockerfile # Use the Dockerfile in this directory to build the image
        container_name: airflow-init
        entrypoint: /bin/bash
        command:
            - -c
            - |
                airflow db init
                airflow users create \
                  --username airflow \
                  --password airflow \
                  --firstname Admin \
                  --lastname User \
                  --role Admin \
                  --email admin@example.com
        environment:
            AIRFLOW__CORE__EXECUTOR: LocalExecutor
            AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@airflow-db:5432/airflow
            #_PIP_ADDITIONAL_REQUIREMENTS: "yfinance==0.2.66 multitasking==0.0.11"
        volumes:
            - ./dags:/opt/airflow/dags
            - ./logs:/opt/airflow/logs
            - ./plugins:/opt/airflow/plugins
        depends_on:
            - airflow-db
            - iceberg-init
        #restart: always

    mysql:
        container_name: openmetadata_mysql
        image: docker.getcollate.io/openmetadata/db:1.10.7
        command: "--sort_buffer_size=10M"
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_DATABASE: openmetadata_db
            MYSQL_USER: openmetadata_user
            MYSQL_PASSWORD: openmetadata_password
        expose:
            - 3306
        ports:
            - "3306:3306"
        volumes:
            - ./docker-volume/db-data:/var/lib/mysql
        healthcheck:
            test: mysql --user=root --password=$$MYSQL_ROOT_PASSWORD --silent --execute "use openmetadata_db"
            interval: 15s
            timeout: 10s
            retries: 10

    elasticsearch:
        container_name: openmetadata_elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:8.11.4
        environment:
            - discovery.type=single-node
            - ES_JAVA_OPTS=-Xms1024m -Xmx1024m
            - xpack.security.enabled=false
        ports:
            - "9200:9200"
            - "9300:9300"
        healthcheck:
            test: "curl -s http://localhost:9200/_cluster/health?pretty | grep status | grep -qE 'green|yellow' || exit 1"
            interval: 15s
            timeout: 10s
            retries: 10
        volumes:
            - es-data:/usr/share/elasticsearch/data

    execute-migrate-all:
        container_name: execute_migrate_all
        image: docker.getcollate.io/openmetadata/server:1.10.7
        command: "./bootstrap/openmetadata-ops.sh migrate"
        environment:
            OPENMETADATA_CLUSTER_NAME: ${OPENMETADATA_CLUSTER_NAME:-openmetadata}
            SERVER_PORT: ${SERVER_PORT:-8585}
            SERVER_ADMIN_PORT: ${SERVER_ADMIN_PORT:-8586}
            LOG_LEVEL: ${LOG_LEVEL:-INFO}

            # Migration
            MIGRATION_LIMIT_PARAM: ${MIGRATION_LIMIT_PARAM:-1200}

            # OpenMetadata Server Authentication Configuration
            AUTHORIZER_CLASS_NAME: ${AUTHORIZER_CLASS_NAME:-org.openmetadata.service.security.DefaultAuthorizer}
            AUTHORIZER_REQUEST_FILTER: ${AUTHORIZER_REQUEST_FILTER:-org.openmetadata.service.security.JwtFilter}
            AUTHORIZER_ADMIN_PRINCIPALS: ${AUTHORIZER_ADMIN_PRINCIPALS:-[admin]}
            AUTHORIZER_ALLOWED_REGISTRATION_DOMAIN: ${AUTHORIZER_ALLOWED_REGISTRATION_DOMAIN:-["all"]}
            AUTHORIZER_INGESTION_PRINCIPALS: ${AUTHORIZER_INGESTION_PRINCIPALS:-[ingestion-bot]}
            AUTHORIZER_PRINCIPAL_DOMAIN: ${AUTHORIZER_PRINCIPAL_DOMAIN:-"open-metadata.org"}
            AUTHORIZER_ALLOWED_DOMAINS: ${AUTHORIZER_ALLOWED_DOMAINS:-[]}
            AUTHORIZER_ENFORCE_PRINCIPAL_DOMAIN: ${AUTHORIZER_ENFORCE_PRINCIPAL_DOMAIN:-false}
            AUTHORIZER_ENABLE_SECURE_SOCKET: ${AUTHORIZER_ENABLE_SECURE_SOCKET:-false}
            AUTHENTICATION_PROVIDER: ${AUTHENTICATION_PROVIDER:-basic}
            AUTHENTICATION_RESPONSE_TYPE: ${AUTHENTICATION_RESPONSE_TYPE:-id_token}
            CUSTOM_OIDC_AUTHENTICATION_PROVIDER_NAME: ${CUSTOM_OIDC_AUTHENTICATION_PROVIDER_NAME:-""}
            AUTHENTICATION_PUBLIC_KEYS: ${AUTHENTICATION_PUBLIC_KEYS:-[http://localhost:8585/api/v1/system/config/jwks]}
            AUTHENTICATION_AUTHORITY: ${AUTHENTICATION_AUTHORITY:-https://accounts.google.com}
            AUTHENTICATION_CLIENT_ID: ${AUTHENTICATION_CLIENT_ID:-""}
            AUTHENTICATION_CALLBACK_URL: ${AUTHENTICATION_CALLBACK_URL:-""}
            AUTHENTICATION_JWT_PRINCIPAL_CLAIMS: ${AUTHENTICATION_JWT_PRINCIPAL_CLAIMS:-[email,preferred_username,sub]}
            AUTHENTICATION_JWT_PRINCIPAL_CLAIMS_MAPPING: ${AUTHENTICATION_JWT_PRINCIPAL_CLAIMS_MAPPING:-[]}
            AUTHENTICATION_ENABLE_SELF_SIGNUP: ${AUTHENTICATION_ENABLE_SELF_SIGNUP:-true}
            AUTHENTICATION_CLIENT_TYPE: ${AUTHENTICATION_CLIENT_TYPE:-public}
            #For OIDC Authentication, when client is confidential
            OIDC_CLIENT_ID: ${OIDC_CLIENT_ID:-""}
            OIDC_TYPE: ${OIDC_TYPE:-""} # google, azure etc.
            OIDC_CLIENT_SECRET: ${OIDC_CLIENT_SECRET:-""}
            OIDC_SCOPE: ${OIDC_SCOPE:-"openid email profile"}
            OIDC_DISCOVERY_URI: ${OIDC_DISCOVERY_URI:-""}
            OIDC_USE_NONCE: ${OIDC_USE_NONCE:-true}
            OIDC_PREFERRED_JWS: ${OIDC_PREFERRED_JWS:-"RS256"}
            OIDC_RESPONSE_TYPE: ${OIDC_RESPONSE_TYPE:-"code"}
            OIDC_DISABLE_PKCE: ${OIDC_DISABLE_PKCE:-true}
            OIDC_CALLBACK: ${OIDC_CALLBACK:-"http://localhost:8585/callback"}
            OIDC_SERVER_URL: ${OIDC_SERVER_URL:-"http://localhost:8585"}
            OIDC_CLIENT_AUTH_METHOD: ${OIDC_CLIENT_AUTH_METHOD:-"client_secret_post"}
            OIDC_TENANT: ${OIDC_TENANT:-""}
            OIDC_MAX_CLOCK_SKEW: ${OIDC_MAX_CLOCK_SKEW:-""}
            OIDC_CUSTOM_PARAMS: ${OIDC_CUSTOM_PARAMS:-{}}
            OIDC_MAX_AGE: ${OIDC_MAX_AGE:-"0"}
            OIDC_PROMPT_TYPE: ${OIDC_PROMPT_TYPE:-"consent"}
            OIDC_SESSION_EXPIRY: ${OIDC_SESSION_EXPIRY:-"604800"}

            # JWT Configuration
            RSA_PUBLIC_KEY_FILE_PATH: ${RSA_PUBLIC_KEY_FILE_PATH:-"./conf/public_key.der"}
            RSA_PRIVATE_KEY_FILE_PATH: ${RSA_PRIVATE_KEY_FILE_PATH:-"./conf/private_key.der"}
            JWT_ISSUER: ${JWT_ISSUER:-"open-metadata.org"}
            JWT_KEY_ID: ${JWT_KEY_ID:-"Gb389a-9f76-gdjs-a92j-0242bk94356"}
            # OpenMetadata Server Pipeline Service Client Configuration
            PIPELINE_SERVICE_CLIENT_ENDPOINT: ${PIPELINE_SERVICE_CLIENT_ENDPOINT:-http://ingestion:8080}
            PIPELINE_SERVICE_CLIENT_HEALTH_CHECK_INTERVAL: ${PIPELINE_SERVICE_CLIENT_HEALTH_CHECK_INTERVAL:-300}
            SERVER_HOST_API_URL: ${SERVER_HOST_API_URL:-http://openmetadata-server:8585/api}
            PIPELINE_SERVICE_CLIENT_VERIFY_SSL: ${PIPELINE_SERVICE_CLIENT_VERIFY_SSL:-"no-ssl"}
            PIPELINE_SERVICE_CLIENT_SSL_CERT_PATH: ${PIPELINE_SERVICE_CLIENT_SSL_CERT_PATH:-""}
            # Database configuration for MySQL
            DB_DRIVER_CLASS: ${DB_DRIVER_CLASS:-com.mysql.cj.jdbc.Driver}
            DB_SCHEME: ${DB_SCHEME:-mysql}
            DB_PARAMS: ${DB_PARAMS:-allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC}
            DB_USER: ${DB_USER:-openmetadata_user}
            DB_USER_PASSWORD: ${DB_USER_PASSWORD:-openmetadata_password}
            DB_HOST: ${DB_HOST:-mysql}
            DB_PORT: ${DB_PORT:-3306}
            OM_DATABASE: ${OM_DATABASE:-openmetadata_db}
            # ElasticSearch Configurations
            ELASTICSEARCH_HOST: ${ELASTICSEARCH_HOST:- elasticsearch}
            ELASTICSEARCH_PORT: ${ELASTICSEARCH_PORT:-9200}
            ELASTICSEARCH_SCHEME: ${ELASTICSEARCH_SCHEME:-http}
            ELASTICSEARCH_USER: ${ELASTICSEARCH_USER:-""}
            ELASTICSEARCH_PASSWORD: ${ELASTICSEARCH_PASSWORD:-""}
            SEARCH_TYPE: ${SEARCH_TYPE:- "elasticsearch"}
            ELASTICSEARCH_TRUST_STORE_PATH: ${ELASTICSEARCH_TRUST_STORE_PATH:-""}
            ELASTICSEARCH_TRUST_STORE_PASSWORD: ${ELASTICSEARCH_TRUST_STORE_PASSWORD:-""}
            ELASTICSEARCH_CONNECTION_TIMEOUT_SECS: ${ELASTICSEARCH_CONNECTION_TIMEOUT_SECS:-5}
            ELASTICSEARCH_SOCKET_TIMEOUT_SECS: ${ELASTICSEARCH_SOCKET_TIMEOUT_SECS:-60}
            ELASTICSEARCH_KEEP_ALIVE_TIMEOUT_SECS: ${ELASTICSEARCH_KEEP_ALIVE_TIMEOUT_SECS:-600}
            ELASTICSEARCH_BATCH_SIZE: ${ELASTICSEARCH_BATCH_SIZE:-100}
            ELASTICSEARCH_PAYLOAD_BYTES_SIZE: ${ELASTICSEARCH_PAYLOAD_BYTES_SIZE:-10485760} #max payLoadSize in Bytes
            ELASTICSEARCH_INDEX_MAPPING_LANG: ${ELASTICSEARCH_INDEX_MAPPING_LANG:-EN}

            #eventMonitoringConfiguration
            EVENT_MONITOR: ${EVENT_MONITOR:-prometheus}
            EVENT_MONITOR_BATCH_SIZE: ${EVENT_MONITOR_BATCH_SIZE:-10}
            EVENT_MONITOR_PATH_PATTERN: ${EVENT_MONITOR_PATH_PATTERN:-["/api/v1/tables/*", "/api/v1/health-check"]}
            EVENT_MONITOR_LATENCY: ${EVENT_MONITOR_LATENCY:-[]}

            #pipelineServiceClientConfiguration
            PIPELINE_SERVICE_CLIENT_ENABLED: ${PIPELINE_SERVICE_CLIENT_ENABLED:-true}
            PIPELINE_SERVICE_CLIENT_CLASS_NAME: ${PIPELINE_SERVICE_CLIENT_CLASS_NAME:-"org.openmetadata.service.clients.pipeline.airflow.AirflowRESTClient"}
            PIPELINE_SERVICE_IP_INFO_ENABLED: ${PIPELINE_SERVICE_IP_INFO_ENABLED:-false}
            PIPELINE_SERVICE_CLIENT_HOST_IP: ${PIPELINE_SERVICE_CLIENT_HOST_IP:-""}
            PIPELINE_SERVICE_CLIENT_SECRETS_MANAGER_LOADER: ${PIPELINE_SERVICE_CLIENT_SECRETS_MANAGER_LOADER:-"noop"}
            #airflow parameters
            AIRFLOW_USERNAME: ${AIRFLOW_USERNAME:-admin}
            AIRFLOW_PASSWORD: ${AIRFLOW_PASSWORD:-admin}
            AIRFLOW_TIMEOUT: ${AIRFLOW_TIMEOUT:-10}
            AIRFLOW_TRUST_STORE_PATH: ${AIRFLOW_TRUST_STORE_PATH:-""}
            AIRFLOW_TRUST_STORE_PASSWORD: ${AIRFLOW_TRUST_STORE_PASSWORD:-""}
            FERNET_KEY: ${FERNET_KEY:-jJ/9sz0g0OHxsfxOoSfdFdmk3ysNmPRnH3TUAbz3IHA=}

            #secretsManagerConfiguration
            SECRET_MANAGER: ${SECRET_MANAGER:-db}
            # AWS:
            OM_SM_REGION: ${OM_SM_REGION:-""}
            OM_SM_ACCESS_KEY_ID: ${OM_SM_ACCESS_KEY_ID:-""}
            OM_SM_ACCESS_KEY: ${OM_SM_ACCESS_KEY:-""}
            # Azure:
            OM_SM_VAULT_NAME: ${OM_SM_VAULT_NAME:-""}
            OM_SM_CLIENT_ID: ${OM_SM_CLIENT_ID:-""}
            OM_SM_CLIENT_SECRET: ${OM_SM_CLIENT_SECRET:-""}
            OM_SM_TENANT_ID: ${OM_SM_TENANT_ID:-""}

            #email configuration:
            OM_EMAIL_ENTITY: ${OM_EMAIL_ENTITY:-"OpenMetadata"}
            OM_SUPPORT_URL: ${OM_SUPPORT_URL:-"https://slack.open-metadata.org"}
            AUTHORIZER_ENABLE_SMTP: ${AUTHORIZER_ENABLE_SMTP:-false}
            OPENMETADATA_SERVER_URL: ${OPENMETADATA_SERVER_URL:-""}
            OPENMETADATA_SMTP_SENDER_MAIL: ${OPENMETADATA_SMTP_SENDER_MAIL:-""}
            SMTP_SERVER_ENDPOINT: ${SMTP_SERVER_ENDPOINT:-""}
            SMTP_SERVER_PORT: ${SMTP_SERVER_PORT:-""}
            SMTP_SERVER_USERNAME: ${SMTP_SERVER_USERNAME:-""}
            SMTP_SERVER_PWD: ${SMTP_SERVER_PWD:-""}
            SMTP_SERVER_STRATEGY: ${SMTP_SERVER_STRATEGY:-"SMTP_TLS"}

            # Heap OPTS Configurations
            OPENMETADATA_HEAP_OPTS: ${OPENMETADATA_HEAP_OPTS:--Xmx1G -Xms1G}
            # Mask passwords values in UI
            MASK_PASSWORDS_API: ${MASK_PASSWORDS_API:-false}

            #OpenMetadata Web Configuration
            WEB_CONF_URI_PATH: ${WEB_CONF_URI_PATH:-"/api"}
            #HSTS
            WEB_CONF_HSTS_ENABLED: ${WEB_CONF_HSTS_ENABLED:-false}
            WEB_CONF_HSTS_MAX_AGE: ${WEB_CONF_HSTS_MAX_AGE:-"365 days"}
            WEB_CONF_HSTS_INCLUDE_SUBDOMAINS: ${WEB_CONF_HSTS_INCLUDE_SUBDOMAINS:-"true"}
            WEB_CONF_HSTS_PRELOAD: ${WEB_CONF_HSTS_PRELOAD:-"true"}
            #Frame Options
            WEB_CONF_FRAME_OPTION_ENABLED: ${WEB_CONF_FRAME_OPTION_ENABLED:-false}
            WEB_CONF_FRAME_OPTION: ${WEB_CONF_FRAME_OPTION:-"SAMEORIGIN"}
            WEB_CONF_FRAME_ORIGIN: ${WEB_CONF_FRAME_ORIGIN:-""}
            #Content Type
            WEB_CONF_CONTENT_TYPE_OPTIONS_ENABLED: ${WEB_CONF_CONTENT_TYPE_OPTIONS_ENABLED:-false}
            #XSS-Protection
            WEB_CONF_XSS_PROTECTION_ENABLED: ${WEB_CONF_XSS_PROTECTION_ENABLED:-false}
            WEB_CONF_XSS_PROTECTION_ON: ${WEB_CONF_XSS_PROTECTION_ON:-true}
            WEB_CONF_XSS_PROTECTION_BLOCK: ${WEB_CONF_XSS_PROTECTION_BLOCK:-true}
            #CSP
            WEB_CONF_XSS_CSP_ENABLED: ${WEB_CONF_XSS_CSP_ENABLED:-false}
            WEB_CONF_XSS_CSP_POLICY: ${WEB_CONF_XSS_CSP_POLICY:-"default-src 'self'"}
            WEB_CONF_XSS_CSP_REPORT_ONLY_POLICY: ${WEB_CONF_XSS_CSP_REPORT_ONLY_POLICY:-""}
            #Referrer-Policy
            WEB_CONF_REFERRER_POLICY_ENABLED: ${WEB_CONF_REFERRER_POLICY_ENABLED:-false}
            WEB_CONF_REFERRER_POLICY_OPTION: ${WEB_CONF_REFERRER_POLICY_OPTION:-"SAME_ORIGIN"}
            #Permission-Policy
            WEB_CONF_PERMISSION_POLICY_ENABLED: ${WEB_CONF_PERMISSION_POLICY_ENABLED:-false}
            WEB_CONF_PERMISSION_POLICY_OPTION: ${WEB_CONF_PERMISSION_POLICY_OPTION:-""}
            #Cache
            WEB_CONF_CACHE_CONTROL: ${WEB_CONF_CACHE_CONTROL:-""}
            WEB_CONF_PRAGMA: ${WEB_CONF_PRAGMA:-""}
        depends_on:
            elasticsearch:
                condition: service_healthy
            mysql:
                condition: service_healthy

    openmetadata-server:
        container_name: openmetadata_server
        restart: always
        image: docker.getcollate.io/openmetadata/server:1.10.7
        environment:
            OPENMETADATA_CLUSTER_NAME: ${OPENMETADATA_CLUSTER_NAME:-openmetadata}
            SERVER_PORT: ${SERVER_PORT:-8585}
            SERVER_ADMIN_PORT: ${SERVER_ADMIN_PORT:-8586}
            LOG_LEVEL: ${LOG_LEVEL:-INFO}

            # OpenMetadata Server Authentication Configuration
            AUTHORIZER_CLASS_NAME: ${AUTHORIZER_CLASS_NAME:-org.openmetadata.service.security.DefaultAuthorizer}
            AUTHORIZER_REQUEST_FILTER: ${AUTHORIZER_REQUEST_FILTER:-org.openmetadata.service.security.JwtFilter}
            AUTHORIZER_ADMIN_PRINCIPALS: ${AUTHORIZER_ADMIN_PRINCIPALS:-[admin]}
            AUTHORIZER_ALLOWED_REGISTRATION_DOMAIN: ${AUTHORIZER_ALLOWED_REGISTRATION_DOMAIN:-["all"]}
            AUTHORIZER_INGESTION_PRINCIPALS: ${AUTHORIZER_INGESTION_PRINCIPALS:-[ingestion-bot]}
            AUTHORIZER_PRINCIPAL_DOMAIN: ${AUTHORIZER_PRINCIPAL_DOMAIN:-"open-metadata.org"}
            AUTHORIZER_ALLOWED_DOMAINS: ${AUTHORIZER_ALLOWED_DOMAINS:-[]}
            AUTHORIZER_ENFORCE_PRINCIPAL_DOMAIN: ${AUTHORIZER_ENFORCE_PRINCIPAL_DOMAIN:-false}
            AUTHORIZER_ENABLE_SECURE_SOCKET: ${AUTHORIZER_ENABLE_SECURE_SOCKET:-false}
            AUTHENTICATION_PROVIDER: ${AUTHENTICATION_PROVIDER:-basic}
            AUTHENTICATION_RESPONSE_TYPE: ${AUTHENTICATION_RESPONSE_TYPE:-id_token}
            CUSTOM_OIDC_AUTHENTICATION_PROVIDER_NAME: ${CUSTOM_OIDC_AUTHENTICATION_PROVIDER_NAME:-""}
            AUTHENTICATION_PUBLIC_KEYS: ${AUTHENTICATION_PUBLIC_KEYS:-[http://localhost:8585/api/v1/system/config/jwks]}
            AUTHENTICATION_AUTHORITY: ${AUTHENTICATION_AUTHORITY:-https://accounts.google.com}
            AUTHENTICATION_CLIENT_ID: ${AUTHENTICATION_CLIENT_ID:-""}
            AUTHENTICATION_CALLBACK_URL: ${AUTHENTICATION_CALLBACK_URL:-""}
            AUTHENTICATION_JWT_PRINCIPAL_CLAIMS: ${AUTHENTICATION_JWT_PRINCIPAL_CLAIMS:-[email,preferred_username,sub]}
            AUTHENTICATION_JWT_PRINCIPAL_CLAIMS_MAPPING: ${AUTHENTICATION_JWT_PRINCIPAL_CLAIMS_MAPPING:-[]}
            AUTHENTICATION_ENABLE_SELF_SIGNUP: ${AUTHENTICATION_ENABLE_SELF_SIGNUP:-true}
            AUTHENTICATION_CLIENT_TYPE: ${AUTHENTICATION_CLIENT_TYPE:-public}
            #For OIDC Authentication, when client is confidential
            OIDC_CLIENT_ID: ${OIDC_CLIENT_ID:-""}
            OIDC_TYPE: ${OIDC_TYPE:-""} # google, azure etc.
            OIDC_CLIENT_SECRET: ${OIDC_CLIENT_SECRET:-""}
            OIDC_SCOPE: ${OIDC_SCOPE:-"openid email profile"}
            OIDC_DISCOVERY_URI: ${OIDC_DISCOVERY_URI:-""}
            OIDC_USE_NONCE: ${OIDC_USE_NONCE:-true}
            OIDC_PREFERRED_JWS: ${OIDC_PREFERRED_JWS:-"RS256"}
            OIDC_RESPONSE_TYPE: ${OIDC_RESPONSE_TYPE:-"code"}
            OIDC_DISABLE_PKCE: ${OIDC_DISABLE_PKCE:-true}
            OIDC_CALLBACK: ${OIDC_CALLBACK:-"http://localhost:8585/callback"}
            OIDC_SERVER_URL: ${OIDC_SERVER_URL:-"http://localhost:8585"}
            OIDC_CLIENT_AUTH_METHOD: ${OIDC_CLIENT_AUTH_METHOD:-"client_secret_post"}
            OIDC_TENANT: ${OIDC_TENANT:-""}
            OIDC_MAX_CLOCK_SKEW: ${OIDC_MAX_CLOCK_SKEW:-""}
            OIDC_CUSTOM_PARAMS: ${OIDC_CUSTOM_PARAMS:-{}}
            OIDC_MAX_AGE: ${OIDC_MAX_AGE:-"0"}
            OIDC_PROMPT_TYPE: ${OIDC_PROMPT_TYPE:-"consent"}
            OIDC_SESSION_EXPIRY: ${OIDC_SESSION_EXPIRY:-"604800"}

            # JWT Configuration
            RSA_PUBLIC_KEY_FILE_PATH: ${RSA_PUBLIC_KEY_FILE_PATH:-"./conf/public_key.der"}
            RSA_PRIVATE_KEY_FILE_PATH: ${RSA_PRIVATE_KEY_FILE_PATH:-"./conf/private_key.der"}
            JWT_ISSUER: ${JWT_ISSUER:-"open-metadata.org"}
            JWT_KEY_ID: ${JWT_KEY_ID:-"Gb389a-9f76-gdjs-a92j-0242bk94356"}
            # OpenMetadata Server Pipeline Service Client Configuration
            PIPELINE_SERVICE_CLIENT_ENDPOINT: ${PIPELINE_SERVICE_CLIENT_ENDPOINT:-http://ingestion:8080}
            PIPELINE_SERVICE_CLIENT_HEALTH_CHECK_INTERVAL: ${PIPELINE_SERVICE_CLIENT_HEALTH_CHECK_INTERVAL:-300}
            SERVER_HOST_API_URL: ${SERVER_HOST_API_URL:-http://openmetadata-server:8585/api}
            PIPELINE_SERVICE_CLIENT_VERIFY_SSL: ${PIPELINE_SERVICE_CLIENT_VERIFY_SSL:-"no-ssl"}
            PIPELINE_SERVICE_CLIENT_SSL_CERT_PATH: ${PIPELINE_SERVICE_CLIENT_SSL_CERT_PATH:-""}
            # Database configuration for MySQL
            DB_DRIVER_CLASS: ${DB_DRIVER_CLASS:-com.mysql.cj.jdbc.Driver}
            DB_SCHEME: ${DB_SCHEME:-mysql}
            DB_PARAMS: ${DB_PARAMS:-allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC}
            DB_USER: ${DB_USER:-openmetadata_user}
            DB_USER_PASSWORD: ${DB_USER_PASSWORD:-openmetadata_password}
            DB_HOST: ${DB_HOST:-mysql}
            DB_PORT: ${DB_PORT:-3306}
            OM_DATABASE: ${OM_DATABASE:-openmetadata_db}
            # ElasticSearch Configurations
            ELASTICSEARCH_HOST: ${ELASTICSEARCH_HOST:- elasticsearch}
            ELASTICSEARCH_PORT: ${ELASTICSEARCH_PORT:-9200}
            ELASTICSEARCH_SCHEME: ${ELASTICSEARCH_SCHEME:-http}
            ELASTICSEARCH_USER: ${ELASTICSEARCH_USER:-""}
            ELASTICSEARCH_PASSWORD: ${ELASTICSEARCH_PASSWORD:-""}
            SEARCH_TYPE: ${SEARCH_TYPE:- "elasticsearch"}
            ELASTICSEARCH_TRUST_STORE_PATH: ${ELASTICSEARCH_TRUST_STORE_PATH:-""}
            ELASTICSEARCH_TRUST_STORE_PASSWORD: ${ELASTICSEARCH_TRUST_STORE_PASSWORD:-""}
            ELASTICSEARCH_CONNECTION_TIMEOUT_SECS: ${ELASTICSEARCH_CONNECTION_TIMEOUT_SECS:-5}
            ELASTICSEARCH_SOCKET_TIMEOUT_SECS: ${ELASTICSEARCH_SOCKET_TIMEOUT_SECS:-60}
            ELASTICSEARCH_KEEP_ALIVE_TIMEOUT_SECS: ${ELASTICSEARCH_KEEP_ALIVE_TIMEOUT_SECS:-600}
            ELASTICSEARCH_BATCH_SIZE: ${ELASTICSEARCH_BATCH_SIZE:-100}
            ELASTICSEARCH_PAYLOAD_BYTES_SIZE: ${ELASTICSEARCH_PAYLOAD_BYTES_SIZE:-10485760} #max payLoadSize in Bytes
            ELASTICSEARCH_INDEX_MAPPING_LANG: ${ELASTICSEARCH_INDEX_MAPPING_LANG:-EN}

            #eventMonitoringConfiguration
            EVENT_MONITOR: ${EVENT_MONITOR:-prometheus}
            EVENT_MONITOR_BATCH_SIZE: ${EVENT_MONITOR_BATCH_SIZE:-10}
            EVENT_MONITOR_PATH_PATTERN: ${EVENT_MONITOR_PATH_PATTERN:-["/api/v1/tables/*", "/api/v1/health-check"]}
            EVENT_MONITOR_LATENCY: ${EVENT_MONITOR_LATENCY:-[]}

            #pipelineServiceClientConfiguration
            PIPELINE_SERVICE_CLIENT_ENABLED: ${PIPELINE_SERVICE_CLIENT_ENABLED:-true}
            PIPELINE_SERVICE_CLIENT_CLASS_NAME: ${PIPELINE_SERVICE_CLIENT_CLASS_NAME:-"org.openmetadata.service.clients.pipeline.airflow.AirflowRESTClient"}
            PIPELINE_SERVICE_IP_INFO_ENABLED: ${PIPELINE_SERVICE_IP_INFO_ENABLED:-false}
            PIPELINE_SERVICE_CLIENT_HOST_IP: ${PIPELINE_SERVICE_CLIENT_HOST_IP:-""}
            PIPELINE_SERVICE_CLIENT_SECRETS_MANAGER_LOADER: ${PIPELINE_SERVICE_CLIENT_SECRETS_MANAGER_LOADER:-"noop"}
            #airflow parameters
            AIRFLOW_USERNAME: ${AIRFLOW_USERNAME:-admin}
            AIRFLOW_PASSWORD: ${AIRFLOW_PASSWORD:-admin}
            AIRFLOW_TIMEOUT: ${AIRFLOW_TIMEOUT:-10}
            AIRFLOW_TRUST_STORE_PATH: ${AIRFLOW_TRUST_STORE_PATH:-""}
            AIRFLOW_TRUST_STORE_PASSWORD: ${AIRFLOW_TRUST_STORE_PASSWORD:-""}
            FERNET_KEY: ${FERNET_KEY:-jJ/9sz0g0OHxsfxOoSfdFdmk3ysNmPRnH3TUAbz3IHA=}

            #secretsManagerConfiguration
            SECRET_MANAGER: ${SECRET_MANAGER:-db}
            #parameters:
            OM_SM_REGION: ${OM_SM_REGION:-""}
            OM_SM_ACCESS_KEY_ID: ${OM_SM_ACCESS_KEY_ID:-""}
            OM_SM_ACCESS_KEY: ${OM_SM_ACCESS_KEY:-""}

            #email configuration:
            OM_EMAIL_ENTITY: ${OM_EMAIL_ENTITY:-"OpenMetadata"}
            OM_SUPPORT_URL: ${OM_SUPPORT_URL:-"https://slack.open-metadata.org"}
            AUTHORIZER_ENABLE_SMTP: ${AUTHORIZER_ENABLE_SMTP:-false}
            OPENMETADATA_SERVER_URL: ${OPENMETADATA_SERVER_URL:-""}
            OPENMETADATA_SMTP_SENDER_MAIL: ${OPENMETADATA_SMTP_SENDER_MAIL:-""}
            SMTP_SERVER_ENDPOINT: ${SMTP_SERVER_ENDPOINT:-""}
            SMTP_SERVER_PORT: ${SMTP_SERVER_PORT:-""}
            SMTP_SERVER_USERNAME: ${SMTP_SERVER_USERNAME:-""}
            SMTP_SERVER_PWD: ${SMTP_SERVER_PWD:-""}
            SMTP_SERVER_STRATEGY: ${SMTP_SERVER_STRATEGY:-"SMTP_TLS"}

            # Heap OPTS Configurations
            OPENMETADATA_HEAP_OPTS: ${OPENMETADATA_HEAP_OPTS:--Xmx1G -Xms1G}
            # Mask passwords values in UI
            MASK_PASSWORDS_API: ${MASK_PASSWORDS_API:-false}

            #OpenMetadata Web Configuration
            WEB_CONF_URI_PATH: ${WEB_CONF_URI_PATH:-"/api"}
            #HSTS
            WEB_CONF_HSTS_ENABLED: ${WEB_CONF_HSTS_ENABLED:-false}
            WEB_CONF_HSTS_MAX_AGE: ${WEB_CONF_HSTS_MAX_AGE:-"365 days"}
            WEB_CONF_HSTS_INCLUDE_SUBDOMAINS: ${WEB_CONF_HSTS_INCLUDE_SUBDOMAINS:-"true"}
            WEB_CONF_HSTS_PRELOAD: ${WEB_CONF_HSTS_PRELOAD:-"true"}
            #Frame Options
            WEB_CONF_FRAME_OPTION_ENABLED: ${WEB_CONF_FRAME_OPTION_ENABLED:-false}
            WEB_CONF_FRAME_OPTION: ${WEB_CONF_FRAME_OPTION:-"SAMEORIGIN"}
            WEB_CONF_FRAME_ORIGIN: ${WEB_CONF_FRAME_ORIGIN:-""}
            #Content Type
            WEB_CONF_CONTENT_TYPE_OPTIONS_ENABLED: ${WEB_CONF_CONTENT_TYPE_OPTIONS_ENABLED:-false}
            #XSS-Protection
            WEB_CONF_XSS_PROTECTION_ENABLED: ${WEB_CONF_XSS_PROTECTION_ENABLED:-false}
            WEB_CONF_XSS_PROTECTION_ON: ${WEB_CONF_XSS_PROTECTION_ON:-true}
            WEB_CONF_XSS_PROTECTION_BLOCK: ${WEB_CONF_XSS_PROTECTION_BLOCK:-true}
            #CSP
            WEB_CONF_XSS_CSP_ENABLED: ${WEB_CONF_XSS_CSP_ENABLED:-false}
            WEB_CONF_XSS_CSP_POLICY: ${WEB_CONF_XSS_CSP_POLICY:-"default-src 'self'"}
            WEB_CONF_XSS_CSP_REPORT_ONLY_POLICY: ${WEB_CONF_XSS_CSP_REPORT_ONLY_POLICY:-""}
            #Cache
            WEB_CONF_CACHE_CONTROL: ${WEB_CONF_CACHE_CONTROL:-""}
            WEB_CONF_PRAGMA: ${WEB_CONF_PRAGMA:-""}

        expose:
            - 8585
            - 8586
        ports:
            - "8585:8585"
            - "8586:8586"
        depends_on:
            elasticsearch:
                condition: service_healthy
            mysql:
                condition: service_healthy
            execute-migrate-all:
                condition: service_completed_successfully
        healthcheck:
            test: ["CMD", "wget", "-q", "--spider", "http://localhost:8586/healthcheck"]

    ingestion:
        container_name: openmetadata_ingestion
        image: docker.getcollate.io/openmetadata/ingestion:1.10.7
        depends_on:
            elasticsearch:
                condition: service_started
            mysql:
                condition: service_healthy
            openmetadata-server:
                condition: service_started
        environment:
            AIRFLOW__API__AUTH_BACKENDS: "airflow.api.auth.backend.basic_auth,airflow.api.auth.backend.session"
            AIRFLOW__CORE__EXECUTOR: LocalExecutor
            AIRFLOW__OPENMETADATA_AIRFLOW_APIS__DAG_GENERATED_CONFIGS: "/opt/airflow/dag_generated_configs"
            DB_HOST: ${AIRFLOW_DB_HOST:-mysql}
            DB_PORT: ${AIRFLOW_DB_PORT:-3306}
            AIRFLOW_DB: ${AIRFLOW_DB:-airflow_db}
            DB_SCHEME: ${AIRFLOW_DB_SCHEME:-mysql+mysqldb}
            DB_USER: ${AIRFLOW_DB_USER:-airflow_user}
            DB_PASSWORD: ${AIRFLOW_DB_PASSWORD:-airflow_pass}
            # extra connection-string properties for the database
            # EXAMPLE
            # require SSL (only for Postgres)
            # properties: "?sslmode=require"
            DB_PROPERTIES: ${AIRFLOW_DB_PROPERTIES:-}
            # To test the lineage backend
            # AIRFLOW__LINEAGE__BACKEND: airflow_provider_openmetadata.lineage.backend.OpenMetadataLineageBackend
            # AIRFLOW__LINEAGE__AIRFLOW_SERVICE_NAME: local_airflow
            # AIRFLOW__LINEAGE__OPENMETADATA_API_ENDPOINT: http://openmetadata-server:8585/api
            # AIRFLOW__LINEAGE__JWT_TOKEN: ...
        entrypoint: /bin/bash
        command:
            - "/opt/airflow/ingestion_dependency.sh"
        expose:
            - 8080
        volumes:
            - ingestion-volume-dag-airflow:/opt/airflow/dag_generated_configs
            - ingestion-volume-dags:/opt/airflow/dags
            - ingestion-volume-tmp:/tmp

    clickhouse:
        image: clickhouse/clickhouse-server:24.8
        container_name: clickhouse
        restart: always
        ports:
            - "8123:8123" # HTTP
            - "9002:9000" # TCP
        environment:
            - CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1
        volumes:
            - clickhouse_data:/var/lib/clickhouse
            - ./clickhouse/init:/docker-entrypoint-initdb.d:ro
        healthcheck:
            test: ["CMD", "clickhouse-client", "--query", "SELECT 1"]
            interval: 10s
            timeout: 5s
            retries: 5
            start_period: 30s
        depends_on:
            - iceberg-init

    clickhouse-init-users:
        image: clickhouse/clickhouse-server:24.8
        container_name: clickhouse-init-users
        depends_on:
            clickhouse:
                condition: service_healthy
        command: >
            bash -c "
            echo 'Waiting for ClickHouse to be ready...' &&
            sleep 5 &&
            until clickhouse-client --host clickhouse --port 9000 --query 'SELECT 1' > /dev/null 2>&1; do
              echo 'Waiting for ClickHouse...' &&
              sleep 2
            done &&
            echo 'Ensuring users exist...' &&
            clickhouse-client --host clickhouse --port 9000 --multiquery --query \"
            CREATE USER IF NOT EXISTS etl IDENTIFIED BY 'pass';
            GRANT SELECT, INSERT, CREATE, CREATE DATABASE ON *.* TO etl;
            CREATE USER IF NOT EXISTS dbt_user IDENTIFIED BY 'dbt_pass';
            GRANT SELECT, INSERT, CREATE, CREATE DATABASE, ALTER, DROP ON *.* TO dbt_user;
            CREATE USER IF NOT EXISTS openmetadata_user IDENTIFIED BY 'omd_pass';
            GRANT SELECT, INSERT, CREATE, CREATE DATABASE, ALTER, DROP ON *.* TO openmetadata_user;
            \" &&
            echo 'Users verified successfully!' &&
            clickhouse-client --host clickhouse --port 9000 --user dbt_user --password dbt_pass --query 'SELECT 1' &&
            echo 'dbt_user authentication test passed!'
            "
        restart: "on-failure"

    # --- dbt initialization & user setup ---
    dbt:
        # dbt container for building and testing ClickHouse models
        build:
            context: ./dbt # Build context is the current directory
            dockerfile: Dockerfile # Use the Dockerfile in this directory to build dbt image
        container_name: dbt
        depends_on:
            - clickhouse # Ensure ClickHouse starts before dbt
            - clickhouse-init-users # Ensure users are created before dbt
        volumes:
            - ./dbt:/dbt # Mount local dbt project directory
        working_dir: /dbt # Set dbt project directory as the working directory
        tty: true # Keep container running for interactive dbt commands

volumes:
    ingestion-volume-dag-airflow:
    ingestion-volume-dags:
    ingestion-volume-tmp:
    es-data:
    clickhouse_data:
    superset_home:
        external: false
    db_home:
        external: false
    redis:
        external: false
